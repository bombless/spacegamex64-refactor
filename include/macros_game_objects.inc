
IFNDEF MACROS_GAME_OBJECTS_INC
MACROS_GAME_UI_OBJECTS_INC EQU 1


FIREBOLT MACRO
	LOCAL ENDFIREBOLT
	LOCAL CHECKBOLT
	LOCAL NEXTBOLTCHECK
	LOCAL FIREINTHEHOLE
	;LOCATE EMPTY BOLT SLOT
	LEA RBX, QWORD PTR [BOLTS]
	MOV RCX, 00H
	CHECKBOLT:
		MOV AL, BYTE PTR [RBX]
		CMP AL, 00H
		JZ FIREINTHEHOLE	
	NEXTBOLTCHECK:
		ADD RBX, BOLTOBJSIZE
		LOOP CHECKBOLT
		JMP ENDFIREBOLT	;NO BOLT SLOTS AVAILABLE
	
	FIREINTHEHOLE:	;BOLT SLOT FOUND, FIRE AWAY
		INC BYTE PTR [RBX]	;TURN ON
		MOV AL, 0DH
		MOV BYTE PTR [RBX + 02H], AL	;SPRITE
		MOV RAX, SHIPX
		ADD RAX, SHIPORGINX
		ADD RAX, 010H
		MOV BYTE PTR [RBX + 04H], AL	;X
		MOV RAX, SHIPY
		SHR RAX, 01H		
		ADD RAX, SHIPORGINY
		ADD RAX, SHIPTILTY
		SUB RAX, 07H
		MOV BYTE PTR [RBX + 06H], AL	;Y
		
		MOV BYTE PTR [RBX + 08H], 08H	;X
		MOV BYTE PTR [RBX + 09H], 0BH	;Y
		MOV BYTE PTR [RBX + 0AH], 010H	;WIDTH
		MOV BYTE PTR [RBX + 0BH], 08H	;HEIGHT
		MOV AL, SHIPALT
		MOV BYTE PTR [RBX + 0CH], AL	;ALTITUDE
		MOV BYTE PTR [RBX + 0DH], 00H	;TIMER
		MOV BOLTCOOLDOWN, BOLTCOOLDOWNFRAMES
	
	ENDFIREBOLT:
ENDM


BOLTLOGIC MACRO
	;MOVE BOLTS AROUND, SET HIT BOXES
;BOLTOBJ STRUCT
;	MODE DW ?	;0 IF INACTIVE
;	SPRITE DW ?
;	X DW ?
;	Y DW ?
;	HITBOXX DB ?	;X & Y ARE OFFSET FROM TOP LEFT CORNER
;	HITBOXY DB ?
;	HITBOXW DB ?
;	HITBOXH DB ?
;	ALT		DB ?	;ALTITUDE
;BOLTOBJ ENDS	
	LOCAL DEADBOLT
	LOCAL MOVEBOLT

	;LOCATE EMPTY BOLT SLOT
	LEA RBX, QWORD PTR [BOLTS]
	MOV RCX, 08H
	CHECKBOLT:
		MOV AL, BYTE PTR [RBX]
		CMP AL, 00H
		JZ NEXTBOLTCHECK
		;BOLT IS ACTIVE MODE 1, MOVE
		CMP AL, 01H
		JZ MOVEBOLT
			;ELSE IS MODE 2, INCREASE SPRITES ACCORDING TO TIMER
			MOV AL, BYTE PTR [RBX + 0DH]	;TIMER
			INC AL
			CMP AL, 010	;MAX TIME
			JA DEADBOLT
			SHR AL, 03H	;/8
			ADD AL, 031H
			MOV BYTE PTR [RBX + 02H], AL	;SPRITE
			;INCREASE TIMER
			INC BYTE PTR [RBX + 0DH]	;TIMER
			JMP NEXTBOLTCHECK
		MOVEBOLT:
		MOV AL, BYTE PTR [RBX + 06H]	;Y
			DEC AL
			CMP AL, 0FFH	;DON'T WRAP AROUND SCREEN
			JZ DEADBOLT
		MOV BYTE PTR [RBX + 06H], AL
		MOV AL, BYTE PTR [RBX + 04H]	;X
		INC AL
		INC AL
		MOV BYTE PTR [RBX + 04H], AL
		CMP AL, 0F0H
		JB NEXTBOLTCHECK
			DEADBOLT:	;HIT THE EDGE OF THE SCREEN, DISABLE
			XOR RAX, RAX
			MOV BYTE PTR [RBX], AL
		
	NEXTBOLTCHECK:
		ADD RBX, BOLTOBJSIZE
		LOOP CHECKBOLT
ENDM



MOVESHIP MACRO
	LOCAL STARTMOVESHIP
	LOCAL AFTERSHIPLEFT
	LOCAL AFTERSHIPRIGHT
	LOCAL AFTERSHIPUP
	LOCAL AFTERSHIPDOWN
	LOCAL AFTERBOLTCHECK
	LOCAL AFTERBOLTS
	LOCAL COMPASS1
	LOCAL COMPASS2
	LOCAL COMPASS3
	LOCAL COMPASS4
	LOCAL COMPASS5
	LOCAL COMPASS6
	LOCAL COMPASS7
	LOCAL COMPASS8
	LOCAL SETSPRITEBUTTON
	LOCAL CALCALTITUDESPRITE
	LOCAL FULLALTSPRITE
	LOCAL DRAWFUELSPRITES
	LOCAL DEADSHIPFROMNOFUEL
	LOCAL SETFUELSPRITES
	LOCAL NEXTFUELSPRITE
	LOCAL SETALTSPRITE
	LOCAL ENDMOVESHIP
	;CHECK STAGE
	MOV RAX, STAGE
	CMP RAX, 02H
	JBE STARTMOVESHIP
		;CHANGE SPRITE TO RED SHIP:
		MOV AL, 03FH
		MOV BYTE PTR [SPRITES + 02H], AL
	JMP ENDMOVESHIP
	
	;COMBINE KEYBOARD AND MOUSE MOVEMENT INTO ONE BYTE:
	STARTMOVESHIP:
	MOV AL, BYTE PTR [PRESSEDLEFT]
	OR AL, BYTE PTR [POINTERLEFT]
	MOV BYTE PTR [COMBLEFT], AL
	MOV AL, BYTE PTR [PRESSEDRIGHT]
	OR AL, BYTE PTR [POINTERRIGHT]
	MOV BYTE PTR [COMBRIGHT], AL
	MOV AL, BYTE PTR [PRESSEDUP]
	OR AL, BYTE PTR [POINTERUP]
	MOV BYTE PTR [COMBUP], AL
	MOV AL, BYTE PTR [PRESSEDDOWN]
	OR AL, BYTE PTR [POINTERDOWN]
	MOV BYTE PTR [COMBDOWN], AL
	MOV AL, BYTE PTR [PRESSEDFIRE]
	OR AL, BYTE PTR [POINTERFIRE]
	MOV BYTE PTR [COMBFIRE], AL
	
	;CHECK MOVEMENTFRAMERULE
	INC MOVEMENTFRAMERULEC
	MOV RAX, MOVEMENTFRAMERULEC
	CMP RAX, MOVEMENTFRAMERULE
	JNZ ENDMOVESHIP
		;HIT FRAMERULE, RESET COUNTER
		XOR RAX, RAX
		MOV MOVEMENTFRAMERULEC, RAX
	
	MOV RBX, SHIPX
	MOV RDX, SHIPY
	XOR R8, R8
					;MOVE LEFT
	MOV AL, BYTE PTR [COMBLEFT]
	CMP AL, 01H
	JNZ AFTERSHIPLEFT
		CMP RBX, 00H
		JZ AFTERSHIPLEFT
		DEC RBX
		TEST RBX, 01H
		JZ AFTERSHIPLEFT
		;DECREASE Y BY 2
		DEC SHIPTILTY
	AFTERSHIPLEFT:	;MOVE RIGHT
	MOV AL, BYTE PTR [COMBRIGHT]
	CMP AL, 01H
	JNZ AFTERSHIPRIGHT
		CMP RBX, SHIPMAXX
		JZ AFTERSHIPRIGHT
		INC RBX
		TEST RBX, 01H
		JNZ AFTERSHIPRIGHT
		;INCREASE Y BY 2
		INC SHIPTILTY
	AFTERSHIPRIGHT:	;MOVE UP
	MOV AL, BYTE PTR [COMBUP]
	CMP AL, 01H
	JNZ AFTERSHIPUP
		CMP RDX, 00H
		JZ AFTERSHIPUP
		MOV R8, 04H	;GOING UP
		DEC RDX
		DEC RDX
	AFTERSHIPUP:	;MOVE DOWN
	MOV AL, BYTE PTR [COMBDOWN]
	CMP AL, 01H
	JNZ AFTERSHIPDOWN
		CMP RDX, SHIPMAXY
		JZ AFTERSHIPDOWN
		MOV R8, 08H	;GOING UP
		INC RDX
		INC RDX
	AFTERSHIPDOWN:
	MOV SHIPX, RBX
	MOV SHIPY, RDX
	;SET SHIP LOCATION IN SPRITES:
		MOV RAX, SHIPY
		SHR RAX, 01H	;DIVIDE BY TWO
		ADD RAX, SHIPORGINY
			MOV RDX, SHIPTILTY
			ADD RAX, RDX
		SHL RAX, 010H
		MOV RBX, SHIPX
		ADD RBX, SHIPORGINX
		OR RAX, RBX
		MOV DWORD PTR [SPRITES + 04H], EAX
	;SET SPRITE:
		MOV RAX, R8
		MOV BYTE PTR [SPRITES + 02H], AL
	;SET SHADOW SPRITE:
	MOV RAX, SHIPORGINY
	ADD RAX, SHIPTILTY
	ADD RAX, 03H
	MOV RDX, SHIPMAXY
	SHR RDX, 01H
	ADD RAX, RDX
	SHL RAX, 010H
	ADD RAX, SHIPX
	ADD RAX, 0FH
	MOV DWORD PTR [SPRITES + 03FCH], EAX
	MOV RAX, HIDESHADOW
	XOR RAX, 01H
	MOV BYTE PTR [SPRITES + 03F8H], AL
	
	;SET ALTITUDE SPRITES:
		MOV R8, 28
		MOV R9, 7
		MOV R10, SHIPMAXY
		SUB R10, SHIPY
		MOV RCX, 04H	
		LEA RBX, QWORD PTR [TILEMAP1]
		ADD RBX, 0304H
		XOR R11, R11
	CALCALTITUDESPRITE:
		CMP R10, R8	;COMPARE TO 28, IF GREATER OR EQUAL, IT'S A FULL SPRITE
		JAE FULLALTSPRITE
		;ELSE FIND PERCENTAGE FULL
		MOV RAX, R10
		SHL RAX, 01H
		XOR RDX, RDX
		DIV R9
		ADD RAX, 0644H
		;MOVE 28 INTO R10
		MOV R10, R8
		JMP SETALTSPRITE	
		FULLALTSPRITE:
			MOV AX, 064CH
			CMP R11, 03H
			JAE SETALTSPRITE
			INC R11
		SETALTSPRITE:
		MOV WORD PTR [RBX], AX
		SUB R10, R8
		SUB RBX, 040H
		LOOP CALCALTITUDESPRITE
			MOV RAX, R11
			MOV BYTE PTR [SHIPALT], AL

	;FUEL FRAMERULE:
		XOR RAX, RAX
		MOV AL, BYTE PTR [SHIPFUEL]
		INC FUELFRAMERULEC
		MOV RBX, FUELFRAMERULEC
		CMP RBX, FUELFRAMERULE
		JNZ SETFUELSPRITES
		XOR RBX, RBX
		MOV FUELFRAMERULEC, RBX
		CMP AL, 00H
		JZ DEADSHIPFROMNOFUEL
			;DECREASE FUEL
			DEC AL
			MOV BYTE PTR [SHIPFUEL], AL
			JMP SETFUELSPRITES
		DEADSHIPFROMNOFUEL:
			INC NOFUEL
			MOV RBX, 0FFH	;DEATH MODE
			MOV STAGE, RBX
	SETFUELSPRITES:
		SHR RAX, 02H	;/4
		MOV R8, RAX
		MOV RCX, 08H	
		LEA RBX, QWORD PTR [TILEMAP1]
		ADD RBX, 0798H
		MOV RDX, 08H	;COMPARISON GUAGE
	DRAWFUELSPRITES:
		MOV AX, 05E0H
		CMP R8, RDX		;CURRENT FUEL AGAINST INCREASING GAUGE
		JAE FULLFUELCELL
			;ELSE IS LESS THAN FULL CELL
			AND R8, 07H
			ADD RAX, R8
			MOV R8, 00H	;CLEAR FUEL FOR REST OF CELLS
		JMP NEXTFUELSPRITE
		FULLFUELCELL:
			ADD AX, 07H	;FULL CELL
	NEXTFUELSPRITE:
		MOV WORD PTR [RBX], AX	;STORE SPRITE
		ADD RDX, 08H	;INCREASE TO NEXT GUAGE
		INC RBX
		INC RBX
		LOOP DRAWFUELSPRITES
	
	;CHECK BOLT FIRE
	MOV RAX, BOLTCOOLDOWN
	CMP RAX, 00H
	JNZ AFTERBOLTCHECK
		;CHECK FIRE
		MOV AL, BYTE PTR [COMBFIRE]
		CMP AL, 01H
		JNZ AFTERBOLTCHECK
		;ELSE TRY TO FIRE BOLT:
		FIREBOLT	
	AFTERBOLTCHECK:
		BOLTLOGIC
		MOV RAX, BOLTCOOLDOWN
		CMP RAX, 00H
		JZ AFTERBOLTS
		DEC BOLTCOOLDOWN
	AFTERBOLTS:
	
	;SHOW MOVEMENT IN ARCADE JOYSTICK AND BUTTON
		;EIGHT POSSIBLE LOCATIONS IF R8 = UDLR:
		;U000, U00R, 000R, 0D0R, 0D00, 0DL0, 00L0, U0L0
		;OTHER MODES ARE POSSIBLE SINCE KEYBOARD | MOUSE INPUT, BUT THOSE RESULT IN ONLY STANDARD POSITION
	XOR RAX, RAX
	MOV AL, BYTE PTR [COMBUP]
	SHL AL, 01H
	OR AL, BYTE PTR [COMBDOWN]
	SHL AL, 01H
	OR AL, BYTE PTR [COMBLEFT]
	SHL AL, 01H
	OR AL, BYTE PTR [COMBRIGHT]
	MOV R8, RAX		;R8 LOWEST NIBBLE = UDLR
	CMP R8, 08H
	JNZ COMPASS1
		MOV EAX, 0D600B0H	;Y-6
		JMP SETSPRITEBUTTON
	COMPASS1:
	CMP R8, 09H
	JNZ COMPASS2
		MOV EAX, 0D800B4H	;Y-4, X+4
		JMP SETSPRITEBUTTON
	COMPASS2:
	CMP R8, 01H
	JNZ COMPASS3
		MOV EAX, 0DC00B6H	;X+6
		JMP SETSPRITEBUTTON
	COMPASS3:
	CMP R8, 05H
	JNZ COMPASS4
		MOV EAX, 0E000B4H	;Y+4, X+4
		JMP SETSPRITEBUTTON
	COMPASS4:
	CMP R8, 04H
	JNZ COMPASS5
		MOV EAX, 0E200B0H	;Y+6
		JMP SETSPRITEBUTTON
	COMPASS5:
	CMP R8, 06H
	JNZ COMPASS6
		MOV EAX, 0E000ACH	;Y+4, X-4
		JMP SETSPRITEBUTTON
	COMPASS6:
	CMP R8, 02H
	JNZ COMPASS7
		MOV EAX, 0DC00AAH	;X-6
		JMP SETSPRITEBUTTON
	COMPASS7:
	CMP R8, 0AH
	JNZ COMPASS8
		MOV EAX, 0D800ACH	;Y-4, X-4
		JMP SETSPRITEBUTTON
	COMPASS8:
	MOV EAX, 0DC00B0H	;STANDARD X-Y
	SETSPRITEBUTTON:
		MOV DWORD PTR [SPRITES + 0CH], EAX	;STORE BALL LOCATION
	MOV AL, BYTE PTR [COMBFIRE]
	ADD AL, 03CH
	MOV BYTE PTR [SPRITES + 01AH], AL
	
	ENDMOVESHIP:
ENDM


SPAWNENEMY MACRO X, Y, Z	;2D X AND Y [0-255], Z ALTITUDE [0-3]
	;ENEMY TYPE LOADED INTO R8

;ENEMYOBJ STRUCT
;	MODE DW ?	;0 IF INACTIVE
;	SPRITE DW ?
;	X DW ?
;	Y DW ?
;	HITBOXX DB ?	;X & Y ARE OFFSET FROM TOP LEFT CORNER
;	HITBOXY DB ?
;	HITBOXW DB ?
;	HITBOXH DB ?
;	ALT		DB ?	;ALTITUDE 
;ENEMYOBJ ENDS
;ENEMYOBJSIZE = 0DH
;ENEMY ENEMYOBJ 040H DUP(<>)	;64 ENEMIES
	
	LOCAL ENDSPAWNENEMY
	LOCAL SLOTSEARCHLOOP
	LOCAL DETECTINGENEMYTYPE
	LOCAL SPAWNENTRYWALL
	LOCAL NEXTENEMYCLEAN1
	LOCAL NEXTENEMYCLEAN2
	LOCAL WALLLOOP
	LOCAL WALLLOOP2
	LOCAL WALLLOOP3
	LOCAL SPAWNDISH
	LOCAL SPAWNFRONTTURRENT
	LOCAL SPAWNSIDETURRENT
	LOCAL SPAWNTANKER
	LOCAL SPAWNMISSLEUP
	LOCAL SPAWNEBOLT
	LOCAL SPAWNSPRAY
	LOCAL SPAWNWALL
	LOCAL SPAWNWALL2
	LOCAL SPAWNGROUNDPLANE
	LOCAL SPAWNSPACEPLANE
	LOCAL DISTANCELOOP
	LOCAL SPAWNENTRYWALLMEDIUM
	LOCAL SPAWNENTRYWALLLOW
	LOCAL SPAWNMISSLE
	LOCAL SPAWNBOSS
	
	;FIND OPEN ENEMY SLOT
	LEA RDX, QWORD PTR [ENEMY]
	MOV RCX, NUMBEROFENEMY	;MAX NUMBER OF OPEN SLOTS
	XOR R15, R15
	SLOTSEARCHLOOP:
		MOV AL, BYTE PTR [RDX]
		CMP AL, 00H
		JZ DETECTINGENEMYTYPE	;THIS SLOT IS OPEN
		INC R15
		ADD RDX, ENEMYOBJSIZE
		LOOP SLOTSEARCHLOOP
		;IF EMPTY SLOT NOT FOUND, SKIP SPAWN
		JMP ENDSPAWNENEMY
	
	DETECTINGENEMYTYPE:
		CMP R8, 01H
		JZ SPAWNENTRYWALL
		CMP R8, 02H
		JZ SPAWNENTRYWALLMEDIUM
		CMP R8, 03H
		JZ SPAWNENTRYWALLLOW
		CMP R8, 04H
		JZ SPAWNBOSS		
		CMP R8, 01CH
		JZ SPAWNMISSLEUP
		CMP R8, 023H
		JZ SPAWNFRONTTURRENT
		CMP R8, 024H
		JZ SPAWNSIDETURRENT
		CMP R8, 025H
		JZ SPAWNTANKER
		CMP R8, 026H
		JZ SPAWNDISH
		CMP R8, 027H
		JZ SPAWNEBOLT
		CMP R8, 029H
		JZ SPAWNSPRAY
		CMP R8, 021H
		JZ SPAWNWALL
		CMP R8, 022H
		JZ SPAWNWALL2
		CMP R8, 019H
		JZ SPAWNGROUNDPLANE
		CMP R8, 011H
		JZ SPAWNSPACEPLANE
		CMP R8, 01BH
		JZ SPAWNMISSLE
		;IF ENEMY TYPE NOT FOUND, SKIP SPAWN
		JMP ENDSPAWNENEMY
	
	SPAWNENTRYWALL:
		;SINCE THIS IS THE FIRST EVENT, I KNOW THAT ALL THE ENEMIES ARE CLEAR
		;SO I'M GOING TO SPAWN MULTIPLE AT ONCE, DON'T DO THAT OTHERWISE
		MOV RAX, 101
		MOV RBX, 50
		MOV RCX, 0DH
		WALLLOOP:
			MOV BYTE PTR [RDX], 0DH		;MODE 1 + LONG SPRITE + INVISIBLE
			MOV BYTE PTR [RDX + 01H], 00H
			MOV BYTE PTR [RDX + 02H], 011H	;SPRITE
			MOV BYTE PTR [RDX + 04H], AL
			MOV BYTE PTR [RDX + 06H], BL
			MOV BYTE PTR [RDX + 0CH], 02H	;ALT
			MOV BYTE PTR [RDX + 0DH], 00H	;TIMER
				;HIT BOX:
				PUSH RAX
				MOV EAX, 03A140000H			;HWYX
				MOV DWORD PTR [RDX + 08H], EAX	;HITBOX
				POP RAX
			ADD AL, 08H
			ADD BL, 04H
			ADD RDX, ENEMYOBJSIZE
			LOOP WALLLOOP
		;FINAL WALL ON RIGHT SIDE:
			MOV BYTE PTR [RDX], 0DH		;MODE 1 + LONG SPRITE + INVISIBLE
			MOV BYTE PTR [RDX + 01H], 00H
			MOV BYTE PTR [RDX + 02H], 011H	;SPRITE
			MOV BYTE PTR [RDX + 04H], 221
			MOV BYTE PTR [RDX + 06H], 97
			MOV BYTE PTR [RDX + 0CH], 03H	;ALT
				;HIT BOX:
				MOV EAX, 042140000H			;HWYX
				MOV DWORD PTR [RDX + 08H], EAX	;HITBOX
		JMP ENDSPAWNENEMY
		
	SPAWNENTRYWALLMEDIUM:
		;SINCE THIS IS THE FIRST EVENT, I KNOW THAT ALL THE ENEMIES ARE CLEAR
		;SO I'M GOING TO SPAWN MULTIPLE AT ONCE, DON'T DO THAT OTHERWISE		
		MOV RAX, 101
		MOV RBX, 66
		MOV RCX, 0DH
		WALLLOOP2:
			MOV BYTE PTR [RDX], 0DH		;MODE 1 + LONG SPRITE + INVISIBLE
			MOV BYTE PTR [RDX + 01H], 00H
			MOV BYTE PTR [RDX + 02H], 011H	;SPRITE
			MOV BYTE PTR [RDX + 04H], AL
			MOV BYTE PTR [RDX + 06H], BL
			MOV BYTE PTR [RDX + 0CH], 01H	;ALT
			MOV BYTE PTR [RDX + 0DH], 00H	;TIMER
				;HIT BOX:
				PUSH RAX
				MOV EAX, 02A140000H			;HWYX
				MOV DWORD PTR [RDX + 08H], EAX	;HITBOX
				POP RAX
			ADD AL, 08H
			ADD BL, 04H
			NEXTENEMYCLEAN1:
				INC R15
				CMP R15, NUMBEROFENEMY
				JAE ENDSPAWNENEMY	;MAXXED OUT
				ADD RDX, ENEMYOBJSIZE
				CMP BYTE PTR [RDX], 00H
				JNZ NEXTENEMYCLEAN1
			LOOP WALLLOOP2
		;FINAL WALL ON RIGHT SIDE:
			MOV BYTE PTR [RDX], 0DH		;MODE 1 + LONG SPRITE + INVISIBLE
			MOV BYTE PTR [RDX + 01H], 00H
			MOV BYTE PTR [RDX + 02H], 011H	;SPRITE
			MOV BYTE PTR [RDX + 04H], 221
			MOV BYTE PTR [RDX + 06H], 97
			MOV BYTE PTR [RDX + 0CH], 03H	;ALT
				;HIT BOX:
				MOV EAX, 042140000H			;HWYX
				MOV DWORD PTR [RDX + 08H], EAX	;HITBOX
		JMP ENDSPAWNENEMY
		
	SPAWNENTRYWALLLOW:
		;SINCE THIS IS THE FIRST EVENT, I KNOW THAT ALL THE ENEMIES ARE CLEAR
		;SO I'M GOING TO SPAWN MULTIPLE AT ONCE, DON'T DO THAT OTHERWISE
		MOV RAX, 101
		MOV RBX, 82
		MOV RCX, 0DH
		WALLLOOP3:
			MOV BYTE PTR [RDX], 0DH		;MODE 1 + LONG SPRITE + INVISIBLE
			MOV BYTE PTR [RDX + 01H], 00H
			MOV BYTE PTR [RDX + 02H], 011H	;SPRITE
			MOV BYTE PTR [RDX + 04H], AL
			MOV BYTE PTR [RDX + 06H], BL
			MOV BYTE PTR [RDX + 0CH], 00H	;ALT
			MOV BYTE PTR [RDX + 0DH], 00H	;TIMER
				;HIT BOX:
				PUSH RAX
				MOV EAX, 01A140000H			;HWYX
				MOV DWORD PTR [RDX + 08H], EAX	;HITBOX
				POP RAX
			ADD AL, 08H
			ADD BL, 04H
			NEXTENEMYCLEAN2:
				INC R15
				CMP R15, NUMBEROFENEMY
				JAE ENDSPAWNENEMY	;MAXXED OUT
				ADD RDX, ENEMYOBJSIZE
				CMP BYTE PTR [RDX], 00H
				JNZ NEXTENEMYCLEAN2
			LOOP WALLLOOP3
		JMP ENDSPAWNENEMY
		
	SPAWNFRONTTURRENT:
		;SET UP INITIAL VALUES
		INC BYTE PTR [RDX]	;SET TO MODE 1
		MOV BYTE PTR [RDX + 01H], 00H
		MOV BYTE PTR [RDX + 02H], 023H	;SPRITE
		MOV RAX, X
		MOV BYTE PTR [RDX + 04H], AL
		MOV RAX, Y
		MOV BYTE PTR [RDX + 06H], AL
		MOV RAX, Z
		MOV BYTE PTR [RDX + 0CH], AL
		MOV BYTE PTR [RDX + 0DH], 00H	;TIMER
			;HIT BOX:
			MOV EAX, 00C13060BH			;HWYX
			MOV DWORD PTR [RDX + 08H], EAX	;HITBOX
		JMP ENDSPAWNENEMY

	SPAWNSIDETURRENT:
		;SET UP INITIAL VALUES
		INC BYTE PTR [RDX]	;SET TO MODE 1
		MOV BYTE PTR [RDX + 01H], 00H
		MOV BYTE PTR [RDX + 02H], 024H	;SPRITE
		MOV RAX, X
		MOV BYTE PTR [RDX + 04H], AL
		MOV RAX, Y
		MOV BYTE PTR [RDX + 06H], AL
		MOV RAX, Z
		MOV BYTE PTR [RDX + 0CH], AL
		MOV BYTE PTR [RDX + 0DH], 00H	;TIMER
			;HIT BOX:
			MOV EAX, 0111D0701H			;HWYX
			MOV DWORD PTR [RDX + 08H], EAX	;HITBOX
		JMP ENDSPAWNENEMY

	SPAWNTANKER:
		;SET UP INITIAL VALUES
		INC BYTE PTR [RDX]	;SET TO MODE 1
		MOV BYTE PTR [RDX + 01H], 00H
		MOV BYTE PTR [RDX + 02H], 025H	;SPRITE
		MOV RAX, X
		MOV BYTE PTR [RDX + 04H], AL
		MOV RAX, Y
		MOV BYTE PTR [RDX + 06H], AL
		MOV RAX, Z
		MOV BYTE PTR [RDX + 0CH], AL
		MOV BYTE PTR [RDX + 0DH], 00H	;TIMER
			;HIT BOX:
			MOV EAX, 01C1C0002H			;HWYX
			MOV DWORD PTR [RDX + 08H], EAX	;HITBOX
		JMP ENDSPAWNENEMY

	SPAWNDISH:
		;SET UP INITIAL VALUES
		INC BYTE PTR [RDX]	;SET TO MODE 1
		MOV BYTE PTR [RDX + 01H], 00H
		MOV BYTE PTR [RDX + 02H], 026H	;SPRITE
		MOV RAX, X
		MOV BYTE PTR [RDX + 04H], AL
		MOV RAX, Y
		MOV BYTE PTR [RDX + 06H], AL
		MOV RAX, Z
		MOV BYTE PTR [RDX + 0CH], AL
		MOV BYTE PTR [RDX + 0DH], 00H	;TIMER
			;HIT BOX:
			MOV EAX, 01A1A0202H			;HWYX
			MOV DWORD PTR [RDX + 08H], EAX	;HITBOX
		JMP ENDSPAWNENEMY
	
	SPAWNMISSLEUP:
		;SET UP INITIAL VALUES
		MOV BYTE PTR [RDX], 075H	;DELAY, INVISIBLE, NO HIT, GO UP
		MOV BYTE PTR [RDX + 01H], 00H
		MOV BYTE PTR [RDX + 02H], 01CH	;SPRITE
		MOV RAX, X
		MOV BYTE PTR [RDX + 04H], AL
		MOV RAX, Y
		MOV BYTE PTR [RDX + 06H], AL
		MOV RAX, Z
		MOV BYTE PTR [RDX + 0CH], AL
		MOV BYTE PTR [RDX + 0DH], 00H	;TIMER
			;HIT BOX:
			MOV EAX, 00A05030DH			;HWYX
			MOV DWORD PTR [RDX + 08H], EAX	;HITBOX
		JMP ENDSPAWNENEMY
		
	SPAWNEBOLT:
		;SET UP INITIAL VALUES
		MOV BYTE PTR [RDX], 081H	;SET TO MODE 1 + FLY DOWN TRACK
		MOV BYTE PTR [RDX + 01H], 00H
		MOV BYTE PTR [RDX + 02H], 027H	;SPRITE
		MOV RAX, X
		MOV BYTE PTR [RDX + 04H], AL
		MOV RAX, Y
		MOV BYTE PTR [RDX + 06H], AL
		MOV RAX, Z
		MOV BYTE PTR [RDX + 0CH], AL
		MOV BYTE PTR [RDX + 0DH], 00H	;TIMER
			;HIT BOX:
			MOV EAX, 004070F0BH			;HWYX
			MOV DWORD PTR [RDX + 08H], EAX	;HITBOX
		JMP ENDSPAWNENEMY
		
	SPAWNMISSLE:
		;SET UP INITIAL VALUES
		MOV BYTE PTR [RDX], 081H	;SET TO MODE 1 + FLY DOWN TRACK
		MOV BYTE PTR [RDX + 01H], 00H
		MOV BYTE PTR [RDX + 02H], 01BH	;SPRITE
		MOV RAX, X
		MOV BYTE PTR [RDX + 04H], AL
		MOV RAX, Y
		MOV BYTE PTR [RDX + 06H], AL
		MOV RAX, Z
		MOV BYTE PTR [RDX + 0CH], AL
		MOV BYTE PTR [RDX + 0DH], 00H	;TIMER
			;HIT BOX:
			MOV EAX, 008091201H			;HWYX
			MOV DWORD PTR [RDX + 08H], EAX	;HITBOX
		JMP ENDSPAWNENEMY

	SPAWNSPRAY:
		;SET UP INITIAL VALUES
		MOV WORD PTR [RDX], 0241H	;SET TO MODE 1 + SKIP HITBOX CHECK + SHORT TIMER
		MOV BYTE PTR [RDX + 02H], 029H	;SPRITE
		MOV RAX, X
		MOV BYTE PTR [RDX + 04H], AL
		MOV RAX, Y
		MOV BYTE PTR [RDX + 06H], AL
		MOV RAX, Z
		MOV BYTE PTR [RDX + 0CH], AL
		MOV BYTE PTR [RDX + 0DH], 00H	;TIMER
			;HIT BOX:
			MOV EAX, 000000000H			;HWYX
			MOV DWORD PTR [RDX + 08H], EAX	;HITBOX
		JMP ENDSPAWNENEMY
		
	SPAWNWALL:
		;SET UP INITIAL VALUES
		MOV WORD PTR [RDX], 01H	;SET TO MODE 1
		MOV BYTE PTR [RDX + 02H], 021H	;SPRITE
		MOV RAX, X
		MOV BYTE PTR [RDX + 04H], AL
		MOV RAX, Y
		MOV BYTE PTR [RDX + 06H], AL
		MOV RAX, Z
		MOV BYTE PTR [RDX + 0CH], AL
		MOV BYTE PTR [RDX + 0DH], 00H	;TIMER
			;HIT BOX:
			MOV EAX, 01A200300H			;HWYX
			MOV DWORD PTR [RDX + 08H], EAX	;HITBOX
		JMP ENDSPAWNENEMY		
		
	SPAWNWALL2:
		;SET UP INITIAL VALUES
		MOV WORD PTR [RDX], 01H	;SET TO MODE 1
		MOV BYTE PTR [RDX + 02H], 022H	;SPRITE
		MOV RAX, X
		MOV BYTE PTR [RDX + 04H], AL
		MOV RAX, Y
		MOV BYTE PTR [RDX + 06H], AL
		MOV RAX, Z
		MOV BYTE PTR [RDX + 0CH], AL
		MOV BYTE PTR [RDX + 0DH], 00H	;TIMER
			;HIT BOX:
			MOV EAX, 01A200300H			;HWYX
			MOV DWORD PTR [RDX + 08H], EAX	;HITBOX
		JMP ENDSPAWNENEMY

	SPAWNGROUNDPLANE:
		;SET UP INITIAL VALUES
		INC BYTE PTR [RDX]	;SET TO MODE 1
		MOV BYTE PTR [RDX + 01H], 00H
		MOV BYTE PTR [RDX + 02H], 019H	;SPRITE
		MOV RAX, X
		MOV BYTE PTR [RDX + 04H], AL
		MOV RAX, Y
		MOV BYTE PTR [RDX + 06H], AL
		MOV RAX, Z
		MOV BYTE PTR [RDX + 0CH], AL
		MOV BYTE PTR [RDX + 0DH], 00H	;TIMER
			;HIT BOX:
			MOV EAX, 00E190804H			;HWYX
			MOV DWORD PTR [RDX + 08H], EAX	;HITBOX
		JMP ENDSPAWNENEMY
		
	SPAWNSPACEPLANE:	;THESE ARE SPAWNED TO AIM AT THE PLAYER
		;SET UP INITIAL VALUES
		MOV BYTE PTR [RDX], 081H	;SET TO MODE 1 + FLY DOWN
		MOV BYTE PTR [RDX + 01H], 00H	
		MOV AL, 03H
		SUB AL, BYTE PTR [SHIPALT]	;REVERSE ORDER
		ADD AL, 011H	;BASE SPRITE
		MOV BYTE PTR [RDX + 02H], AL	;SPRITE
		
		LEA RBX, [SPRITES]	;FIRST SPRITE IS SHIP SPRITE
		MOV AL, BYTE PTR [RBX + 04H]	;X
		MOV BL, BYTE PTR [RBX + 06H] 	;Y
		
		DISTANCELOOP:
			INC AL
			INC AL
			DEC BL
			CMP AL, 0EDH
			JB DISTANCELOOP
		
		MOV BYTE PTR [RDX + 04H], AL
		MOV BYTE PTR [RDX + 06H], BL
		MOV AL, BYTE PTR [SHIPALT]
		MOV BYTE PTR [RDX + 0CH], AL
		MOV BYTE PTR [RDX + 0DH], 00H	;TIMER
			;HIT BOX:
			MOV EAX, 00E190804H			;HWYX
			MOV DWORD PTR [RDX + 08H], EAX	;HITBOX
		JMP ENDSPAWNENEMY	
		
	SPAWNBOSS:
		;FOUR HIT BOXES
		LEA RDX, QWORD PTR [ENEMY]
		MOV WORD PTR [RDX], 01803H	;SET TO MODE 1 + 6 HIT POINTS
		MOV BYTE PTR [RDX + 02H], 034H	;SPRITE
		MOV RAX, X
		MOV BYTE PTR [RDX + 04H], AL
		MOV RAX, Y
		MOV BYTE PTR [RDX + 06H], AL
		MOV RAX, 0	;0 ALTITUDE
		MOV BYTE PTR [RDX + 0CH], AL
		MOV BYTE PTR [RDX + 0DH], 00H	;TIMER
			;HIT BOX:
			MOV EAX, 032320707H			;HWYX
			MOV DWORD PTR [RDX + 08H], EAX	;HITBOX
		
		ADD RDX, ENEMYOBJSIZE
		MOV BYTE PTR [RDX], 043H	;SET TO MODE + NO HITBOX CHECK
		MOV BYTE PTR [RDX + 01H], 00H
		MOV BYTE PTR [RDX + 02H], 035H	;SPRITE
		MOV RAX, X
		ADD RAX, 020H
		MOV BYTE PTR [RDX + 04H], AL
		MOV RAX, Y
		MOV BYTE PTR [RDX + 06H], AL
		MOV RAX, Z
		MOV BYTE PTR [RDX + 0CH], AL
		MOV BYTE PTR [RDX + 0DH], 00H	;TIMER
			;HIT BOX:
			MOV EAX, 000000000H			;HWYX
			MOV DWORD PTR [RDX + 08H], EAX	;HITBOX
		
		ADD RDX, ENEMYOBJSIZE
		MOV BYTE PTR [RDX], 043H	;SET TO MODE + NO HITBOX CHECK
		MOV BYTE PTR [RDX + 01H], 00H
		MOV BYTE PTR [RDX + 02H], 036H	;SPRITE
		MOV RAX, X
		MOV BYTE PTR [RDX + 04H], AL
		MOV RAX, Y
		ADD RAX, 020H
		MOV BYTE PTR [RDX + 06H], AL
		MOV RAX, Z
		DEC RAX
		MOV BYTE PTR [RDX + 0CH], AL
		MOV BYTE PTR [RDX + 0DH], 00H	;TIMER
			;HIT BOX:
			MOV EAX, 000000000H			;HWYX
			MOV DWORD PTR [RDX + 08H], EAX	;HITBOX
			
		ADD RDX, ENEMYOBJSIZE
		MOV BYTE PTR [RDX], 043H	;SET TO MODE + NO HITBOX CHECK
		MOV BYTE PTR [RDX + 01H], 00H
		MOV BYTE PTR [RDX + 02H], 037H	;SPRITE
		MOV RAX, X
		ADD RAX, 020H
		MOV BYTE PTR [RDX + 04H], AL
		MOV RAX, Y
		ADD RAX, 020H
		MOV BYTE PTR [RDX + 06H], AL
		MOV RAX, Z
		DEC RAX
		MOV BYTE PTR [RDX + 0CH], AL
		MOV BYTE PTR [RDX + 0DH], 00H	;TIMER
			;HIT BOX:
			MOV EAX, 000000000H			;HWYX
			MOV DWORD PTR [RDX + 08H], EAX	;HITBOX	
			
		JMP ENDSPAWNENEMY	
	
	ENDSPAWNENEMY:
ENDM



ENEMYLOGIC MACRO
	LOCAL ENEMYLOGICLOOP
	LOCAL NEXTENEMYLOGIC
	LOCAL EXPLODEENEMYANIMATION
	LOCAL DEADENEMY
	LOCAL ENDENEMYLOGIC
	
	INC ELOGICFRAMERULEC
	MOV RAX, ELOGICFRAMERULEC
	CMP RAX, ELOGICFRAMERULE
	JNZ ENDENEMYLOGIC
		XOR RAX, RAX
		MOV ELOGICFRAMERULEC, RAX
	
	MOV RCX, 00H
	LEA RBX, QWORD PTR [ENEMY]
	ENEMYLOGICLOOP:
		XOR RAX, RAX
		MOV AL, BYTE PTR [RBX]	;MODE
		CMP AL, 00H
		JZ NEXTENEMYLOGIC
		
		;CHECK FOR EXPLOSION TIMER
		MOV AL, BYTE PTR [RBX + 01H]	;MODE HIGH BYTE
		TEST AL, 01H	;EXPLOSION TIMER
		JZ CHECKFORLANDTANKS
			;CHECK FUEL TANKS: 
			MOV AL, BYTE PTR [RBX + 02H]	;SPRITE
			CMP AL, 025H
			JNZ EXPLODEENEMYANIMATION
				;THIS WILL ONLY OCCUR ONCE SINCE THE SPRITE IS ABOUT TO BE CHANGED
				;INCREASE SHIP'S FUEL
				MOV AL, BYTE PTR [SHIPFUEL]
				ADD AX, BONUSFUEL
				CMP AX, 0100H
				JA FULLFUEL
					MOV BYTE PTR [SHIPFUEL], AL
				JMP EXPLODEENEMYANIMATION
				FULLFUEL:
					MOV BYTE PTR [SHIPFUEL], 0FFH
			EXPLODEENEMYANIMATION:
			;INCREASE SPRITES ACCORDING TO TIMER
			MOV AL, BYTE PTR [RBX + 0DH]	;TIMER
			INC AL
			CMP AL, 030	;MAX TIME
			JA DEADENEMY
			SHR AL, 03H	;/8
			AND AL, 01H
			ADD AL, 02FH
			MOV BYTE PTR [RBX + 02H], AL	;SPRITE
			;INCREASE TIMER
			INC BYTE PTR [RBX + 0DH]	;TIMER
			JMP NEXTENEMYLOGIC
		
		CHECKFORLANDTANKS:
		MOV AL, BYTE PTR [RBX + 02H]	;SPRITE
		CMP AL, 023H	;LAND TANK SPRITE
		JNZ CHECKENEMYDELAY
			;RANDOM FIRE ENEMY MISSLES (027H) AT PLAYER
			RNG	;FILL RAX WITH RANDOM VARIABLE
			AND RAX, 03FH
			CMP RAX, 03FH
			JNZ NEXTENEMYLOGIC
			;SPAWN MISSLE
			PUSH RBX
			PUSH RCX
				XOR RAX, RAX
				MOV AL, BYTE PTR [RBX + 04H]	;X
				SUB AL, 018H
				MOV R10, RAX	;DEST X
				MOV AL, BYTE PTR [RBX + 06H]	;Y
				ADD AL, 09H
				MOV R11, RAX	;DEST Y
				MOV R8, 027H	;SPAWN MISSLE
				SPAWNENEMY R10, R11, 0
			POP RCX
			POP RBX
		JMP NEXTENEMYLOGIC
		
		CHECKENEMYDELAY:
		MOV AL, BYTE PTR [RBX]	;MODE
		TEST AL, 20H	;DELAY BIT
		JZ ENEMYGOUP
			;MUST BE BELOW THE MINIMUM Y VALUE OF SHIP
			MOV AL, BYTE PTR [RBX + 06H]	;Y
			ADD AL, 40H
			CMP AL, SHIPORGINY
			JBE ENEMYGOUP
			;CHECK TO END DELAY
			RNG	;FILL RAX WITH RANDOM VARIABLE
			AND RAX, 07FH
			CMP RAX, 07FH
			JNZ NEXTENEMYLOGIC
			;TURN OFF DELAY, INVISIBLE, AND NO HITBOX
			MOV AL, BYTE PTR [RBX]	;MODE
			AND AL, 093H
			MOV BYTE PTR [RBX], AL
			;SPAWN ENEMY FIRE UNDERNEATH	(029H)
			;SPAWN MISSLE
			PUSH RBX
			PUSH RCX
				XOR RAX, RAX
				MOV AL, BYTE PTR [RBX + 04H]	;X
				MOV R10, RAX	;DEST X
				MOV AL, BYTE PTR [RBX + 06H]	;Y
				ADD AL, 04H
				MOV R11, RAX	;DEST Y
				MOV R8, 029H	;SPAWN SPRAY
				SPAWNENEMY R10, R11, 0
			POP RCX
			POP RBX
			
			JMP NEXTENEMYLOGIC
			
		ENEMYGOUP:	
		MOV AL, BYTE PTR [RBX]	;MODE
		XOR AL, 04H
		AND AL, 14H
		CMP AL, 14H	;GO UP BIT + NO INVISIBLE BIT
		JNZ CHECKMISSLELAUNCH			
			;DECREASE Y BY SPEED
			ENEMYFLYSPEED EQU 01
			MOV AL, BYTE PTR [RBX + 06H]	;Y
			SUB AL, ENEMYFLYSPEED
			MOV BYTE PTR [RBX + 06H], AL	;Y
			CMP AL, 020H
			JB DEADENEMY	;TOO HIGH, KILL IT OFF
			;MAINTAIN PROPER ALTITUDE (10px EACH)
			MOV AL, BYTE PTR [RBX + 0DH]	;TIMER
			INC AL
			CMP AL, 0CH
			JB STOREALTTIMER
				;ELSE INCREASE ALTITUDE AND RESET TIMER
				MOV AL, BYTE PTR [RBX + 0CH]
				CMP AL, 03H
				JAE STOREALTTIMER
					INC BYTE PTR [RBX + 0CH]
			STOREALTTIMER:
				MOV BYTE PTR [RBX + 0DH], AL	;TIMER
			JMP NEXTENEMYLOGIC
		
		CHECKMISSLELAUNCH:
		MOV AL, BYTE PTR [RBX + 01H]	;MODE HIGH BYTE
		TEST AL, 02H	;SHORT TIMER BIT
		JZ CHECKBOSS
			;COUNT TO 32, DELETE
			INC BYTE PTR [RBX + 0DH]
			MOV AL, BYTE PTR [RBX + 0DH]	;TIMER
			CMP AL, 010H
			JAE DEADENEMY
				;SET SPRITE:
			SHR AL, 02H
			ADD AL, 029H
			MOV BYTE PTR [RBX + 02H], AL	;SPRITE
			JMP  NEXTENEMYLOGIC
		
		CHECKBOSS:
		MOV AL, BYTE PTR [RBX + 02H]	;SPRITE
		CMP AL, 034H	;BOSS + 3 OTHER SPRITES
		JNZ CHECKFLYMISSLE
			;CHECK HEALTH:
			MOV AL, BYTE PTR [RBX + 01H]
			SHR AL, 02H	;HP
			CMP AL, 00H
			JNZ MOVEBOSS
				;ALREADY DEAD, DESTROY SELF
				XOR RAX, RAX
				MOV WORD PTR [RBX], AX
				MOV WORD PTR [RBX + ENEMYOBJSIZE], AX
				MOV WORD PTR [RBX + ENEMYOBJSIZE*2], AX
				MOV WORD PTR [RBX + ENEMYOBJSIZE*3], AX
				
				;SPAWN EXPLOSION:
				MOV AL, BYTE PTR [RBX + 04H]	;X
				ADD AL, 10H
				MOV R10, RAX
				MOV AL, BYTE PTR [RBX + 06H]	;Y
				ADD AL, 10H
				MOV R11, RAX
				MOV R8, 029H	;SPAWN SPRAY
				PUSH RBX
				PUSH RCX
					SPAWNENEMY R10, R11, 0
				POP RCX
				POP RBX
				;SET WIN TIME OUT
					INC WINTIMER
				JMP NEXTENEMYLOGIC
			MOVEBOSS:
			;RANDOMLY LAUNCH MISSLE
			RNG	;FILL RAX WITH RANDOM VARIABLE
			AND RAX, 07FH
			CMP RAX, 07FH
			JNZ MOVETHEBOSS
			;SPAWN MISSLE
			PUSH RBX
			PUSH RCX
				XOR RAX, RAX
				MOV AL, BYTE PTR [RBX + 04H]	;X
				ADD AL, 0FH
				MOV R10, RAX	;DEST X
				MOV AL, BYTE PTR [RBX + 06H]	;Y
				ADD AL, 0EH
				MOV R11, RAX	;DEST Y
				MOV R8, 01BH	;SPAWN MISSLE
				SPAWNENEMY R10, R11, 0
			POP RCX
			POP RBX
			
			MOVETHEBOSS:
			INC BOSSMOVEFRAMERULEC
			MOV RAX, BOSSMOVEFRAMERULEC
			CMP RAX, BOSSMOVEFRAMERULE
			JNZ NEXTENEMYLOGIC
			MOV BOSSMOVEFRAMERULEC, 00H
			;IF TIMER == 0 GO LEFT, IF TIMER == 1 GO RIGHT
			MOV AL, BYTE PTR [RBX + 0DH]	;TIMER
			CMP AL, 00H
			JZ MOVEBOSSLEFT
			MOVEBOSSRIGHT:
				MOV AL, BYTE PTR [RBX + 06H]	;Y
				ADD AL, 01H
				MOV BYTE PTR [RBX + 06H], AL
				MOV BYTE PTR [RBX + 06H + ENEMYOBJSIZE], AL
				ADD AL, 020H
				MOV BYTE PTR [RBX + 06H + ENEMYOBJSIZE*2], AL
				MOV BYTE PTR [RBX + 06H + ENEMYOBJSIZE*3], AL
				
				MOV AL, BYTE PTR [RBX + 04H]	;X
				ADD AL, 02H
				MOV BYTE PTR [RBX + 04H], AL
				MOV BYTE PTR [RBX + 04H + ENEMYOBJSIZE*2], AL
				ADD AL, 020H
				MOV BYTE PTR [RBX + 04H + ENEMYOBJSIZE], AL
				MOV BYTE PTR [RBX + 04H + ENEMYOBJSIZE*3], AL
				CMP AL, 0E6H
				JBE NEXTENEMYLOGIC
					;ELSE RESET TO MOVE LEFT 
				MOV BYTE PTR [RBX + 0DH], 00H	;TIMER
				
			MOVEBOSSLEFT:
				MOV AL, BYTE PTR [RBX + 06H]	;Y
				SUB AL, 01H
				MOV BYTE PTR [RBX + 06H], AL
				MOV BYTE PTR [RBX + 06H + ENEMYOBJSIZE], AL
				ADD AL, 020H
				MOV BYTE PTR [RBX + 06H + ENEMYOBJSIZE*2], AL
				MOV BYTE PTR [RBX + 06H + ENEMYOBJSIZE*3], AL
				
				MOV AL, BYTE PTR [RBX + 04H]	;X
				SUB AL, 02H
				MOV BYTE PTR [RBX + 04H], AL
				MOV BYTE PTR [RBX + 04H + ENEMYOBJSIZE*2], AL
				ADD AL, 020H
				MOV BYTE PTR [RBX + 04H + ENEMYOBJSIZE], AL
				MOV BYTE PTR [RBX + 04H + ENEMYOBJSIZE*3], AL
				CMP AL, 08CH
				JA NEXTENEMYLOGIC
					;ELSE RESET TO MOVE RIGHT 
				MOV BYTE PTR [RBX + 0DH], 01H	;TIMER
				
			
			JMP NEXTENEMYLOGIC
		
		CHECKFLYMISSLE:
		MOV AL, BYTE PTR [RBX]
		TEST AL, 080H	;FLY BIT
		JZ NEXTENEMYLOGIC
			MOV RAX, PAUSESCROLL
			CMP AL, 00H
			JZ NEXTENEMYLOGIC
			;FLY MISSLES (BECAUSE THE SCREEN IS PAUSED WHEN BOSS IS LAUNCHED
			MOV AL, BYTE PTR [RBX + 06H]	;Y
			ADD AL, 01H
			MOV BYTE PTR [RBX + 06H], AL	;Y
			MOV AL, BYTE PTR [RBX + 04H]	;X
			SUB AL, 02H
			MOV BYTE PTR [RBX + 04H], AL	;X
			CMP AL, 0F0H
			JA DEADENEMY			
			
			JMP NEXTENEMYLOGIC
		
		DEADENEMY:
			XOR RAX, RAX
			MOV WORD PTR [RBX], AX
	NEXTENEMYLOGIC:
		ADD RBX, ENEMYOBJSIZE
		INC RCX
		CMP RCX, NUMBEROFENEMY
		JNZ ENEMYLOGICLOOP
	
	ENDENEMYLOGIC:
ENDM



CHECKHITBOXES MACRO
	;CALCULATING AND CHECKING ALL HITBOXES:
	;CALCULATING MAIN SHIP HITBOX:
	LOCAL ENEMYHITCHECK
	LOCAL STANDARDALTCHECK
	LOCAL EXTENSIVEALTCHECK
	LOCAL COMPAREHITBOX
	LOCAL NEXTENEMYHITCHECK
	
	LOCAL CALCBOLTBOX
	LOCAL ENEMYHITCHECK2
	LOCAL NEXTENEMYHITCHECK2
	LOCAL COMPAREHITBOX2
	LOCAL EXTENSIVEALTCHECK2
	LOCAL NEXTBOLTBOX
	LOCAL NORMALENEMYHIT
	

	;SET SHIP LOCATION IN SPRITES:		
		;DEPENDING ON SIZE OF SHIP:
		;DEFAULT SIZE:
		MOV AL, 12	;WIDTH
		MOV BYTE PTR [SHIPHITBOX + 02H], AL
		MOV AL, 8	;HEIGHT
		MOV BYTE PTR [SHIPHITBOX + 03H], AL
		MOV R8, 0BH	;X-OFFSET
		MOV R9, 0CH	;Y-OFFSET
		;LOCATION X
		MOV RAX, SHIPORGINX
		ADD RAX, SHIPX
		ADD RAX, R8
		MOV BYTE PTR [SHIPHITBOX], AL
		MOV RAX, SHIPORGINY
		MOV RBX, SHIPY
		SHR RBX, 01H
		ADD RAX, RBX
		ADD RAX, SHIPTILTY
		ADD RAX, R9
		MOV BYTE PTR [SHIPHITBOX + 01H], AL
		
	;CHECKING SHIP AND ENEMY COLLISIONS:
		;MUST BE ON SAME ALTITUDE UNLESS 4TH BIT IN ENEMY MODE IS SET (IN WHICH CASE ONLY ALTITUDE AND LOWER WILL HIT)
	LEA RDX, QWORD PTR [ENEMY]
	XOR RAX, RAX
	MOV HIT, RAX 
	XOR R8, R8
	XOR RCX, RCX
	ENEMYHITCHECK:
		;CHECK IF ACTIVE
		MOV AL, BYTE PTR [RDX]
		CMP AL, 00H
		JZ NEXTENEMYHITCHECK
		MOV AL, BYTE PTR [RDX + 0DH]
		CMP AL, 00H
		JNZ NEXTENEMYHITCHECK
		;IS ACTIVE, CHECK HITBOX, ESCPAE ONCE CONDITION FALSE
		;COMPARE ALTITUDES:
			MOV AL, BYTE PTR [RDX]
			TEST AL, 08H		;SPECIAL TALL HITBOX
			JNZ EXTENSIVEALTCHECK
			TEST AL, 040H	;NO CHECK HITBOX BIT
			JNZ NEXTENEMYHITCHECK
			STANDARDALTCHECK:
				MOV AL, BYTE PTR [SHIPALT]
				CMP AL, BYTE PTR [RDX + 0CH]
				JNZ NEXTENEMYHITCHECK	;DIFFERENT ALTITUDES, SHIPS IN THE NIGHT
				JMP COMPAREHITBOX
			EXTENSIVEALTCHECK:
				MOV AL, BYTE PTR [HIDESHADOW]
				CMP AL, 00H
				JZ NEXTENEMYHITCHECK	;HIDE SHADOW MUST ALSO BE TURNED ON
				MOV AL, BYTE PTR [SHIPALT]
				CMP AL, BYTE PTR [RDX + 0CH]
				JA NEXTENEMYHITCHECK	;ONLY ESCAPE IF ALTITUDE IS GREATER
				;JMP COMPAREHITBOX
		
		COMPAREHITBOX:
		;X PREP
		MOV BL, BYTE PTR [RDX + 04H]	;EX
		ADD BL, BYTE PTR [RDX + 08H]	;EX OFFSET
		;X1+W1 >= X2 && X2+W2 >= X1
		MOV AL, BYTE PTR [SHIPHITBOX] 		;X
		ADD AL, BYTE PTR [SHIPHITBOX + 02H] ;+W
		CMP AL, BYTE PTR BL
		JB NEXTENEMYHITCHECK
		ADD BL, BYTE PTR [RDX + 0AH]	;EW
		CMP BL, BYTE PTR [SHIPHITBOX]
		JB NEXTENEMYHITCHECK
		;Y PREP
		MOV BL, BYTE PTR [RDX + 06H]	;EY
		ADD BL, BYTE PTR [RDX + 09H]	;EY OFFSET
		;Y1+H1 >= Y2 && Y2+H2 >= Y2
		MOV AL, BYTE PTR [SHIPHITBOX + 01H]	;Y
		ADD AL, BYTE PTR [SHIPHITBOX + 03H]	;+H
		CMP AL, BYTE PTR BL
		JB NEXTENEMYHITCHECK
		ADD BL, BYTE PTR [RDX + 0BH]	;EH
		CMP BL, BYTE PTR [SHIPHITBOX + 01H]
		JB NEXTENEMYHITCHECK
			;CONNECTED
			INC R8
	NEXTENEMYHITCHECK:
		ADD RDX, ENEMYOBJSIZE
		INC RCX
		CMP RCX, NUMBEROFENEMY
		JNZ ENEMYHITCHECK
	MOV HIT, R8
	
	
	
	
	;COMPARE PLAYER BOLTS AGAINST ENEMY HIT BOXES
	MOV RCX, 00H	;NUMBER OF BOLTS COUNTER
	LEA RBX, QWORD PTR [BOLTS]
	CALCBOLTBOX:	;STORE BOLT VALUES IN R8(X),  R9(Y), R10(X+W), R11(Y+H)
		MOV AL, BYTE PTR [RBX]	;MODE
		CMP AL, 01H	;ONLY ALLOW FLYING BOLTS TO COLLIDE
		JNZ NEXTBOLTBOX
		XOR RAX, RAX
		MOV AL, BYTE PTR [RBX + 04H]	;X
		ADD AL, BYTE PTR [RBX + 08H]	;X OFFSET
		MOV R8, RAX
		ADD AL, BYTE PTR [RBX + 0AH]	;WIDTH
		MOV R10, RAX
		MOV AL, BYTE PTR [RBX + 06H]	;Y
		ADD AL, BYTE PTR [RBX + 09H]	;Y OFFSET
		MOV R9, RAX
		ADD AL, BYTE PTR [RBX + 0BH]	;HEIGHT
		MOV R11, RAX
		MOV R12, RBX
		PUSH RCX
	;PREPARE ENEMY DATA:
	LEA RDX, QWORD PTR [ENEMY]
	XOR RCX, RCX
	ENEMYHITCHECK2: 
		;CHECK IF ACTIVE
		MOV AL, BYTE PTR [RDX]
		CMP AL, 00H
		JZ NEXTENEMYHITCHECK2
		MOV AL, BYTE PTR [RDX + 0DH]
		CMP AL, 00H
		JNZ NEXTENEMYHITCHECK2
		;IS ACTIVE, CHECK HITBOX, ESCPAE ONCE CONDITION FALSE
		;COMPARE ALTITUDES:
			MOV AL, BYTE PTR [RDX]
			TEST AL, 08H		;SPECIAL TALL HITBOX
			JNZ EXTENSIVEALTCHECK2
			TEST AL, 040H	;NO CHECK HITBOX BIT
			JNZ NEXTENEMYHITCHECK2
			;STANDARD ALTITUDE CHECK:
				MOV AL, BYTE PTR [R12 + 0CH]	;BOLT ALTITUDE
				CMP AL, BYTE PTR [RDX + 0CH]	;ENEMY ALTITUDE
				JNZ NEXTENEMYHITCHECK2	;DIFFERENT ALTITUDES, SHIPS IN THE NIGHT
				JMP COMPAREHITBOX2
			EXTENSIVEALTCHECK2:
				MOV AL, BYTE PTR [R12 + 0CH]	;BOLT ALTITUDE
				CMP AL, BYTE PTR [RDX + 0CH]
				JA NEXTENEMYHITCHECK2	;ONLY ESCAPE IF ALTITUDE IS GREATER
		
		COMPAREHITBOX2:
		;X PREP
		MOV BL, BYTE PTR [RDX + 04H]	;EX
		ADD BL, BYTE PTR [RDX + 08H]	;EX OFFSET
		;X1+W1 >= X2 && X2+W2 >= X1
		MOV RAX, R10	;BOLT X+W
		CMP AL, BL
		JB NEXTENEMYHITCHECK2
		ADD BL, BYTE PTR [RDX + 0AH]	;EW
		MOV RAX, R8		;BOLT X
		CMP BL, AL
		JB NEXTENEMYHITCHECK2
		;Y PREP
		MOV BL, BYTE PTR [RDX + 06H]	;EY
		ADD BL, BYTE PTR [RDX + 09H]	;EY OFFSET
		;Y1+H1 >= Y2 && Y2+H2 >= Y2
		MOV RAX, R9
		CMP AL, BL
		JB NEXTENEMYHITCHECK2
		ADD BL, BYTE PTR [RDX + 0BH]	;EH
		MOV RAX, R11
		CMP BL, AL
		JB NEXTENEMYHITCHECK2
			;CONNECTED, SET EACH MODE TO 2 TO EXPLODE THEM
			MOV AL, 02H
			MOV BYTE PTR [R12], AL
			MOV BL, BYTE PTR [RDX]	;MODE FOR ENEMY
			TEST BL, 08H			;SPECIAL TALL HITBOX
			JNZ NEXTENEMYHITCHECK2	;IF TALL, DON'T DELETE IT
			;CHECK IF BOSS
			MOV AL, BYTE PTR [RDX + 02H]	;SPRITE
			CMP AL, 034H
			JNZ NORMALENEMYHIT	;NOT THE BOSS
			;DECREASE HP BY 1
			MOV AL, BYTE PTR [RDX + 01H]	;CHECK FOR HIT POINTS
			SUB AL, 04H
			MOV BYTE PTR [RDX + 01H], AL	;NORMALLY THIS WOULD ERASE OTHER BITS, BUT I KNOW THEY'RE NOT SET
			JMP NEXTENEMYHITCHECK2
			NORMALENEMYHIT:
			MOV BYTE PTR [RDX + 01H], 01H	;START THE DEATH TIMER
			MOV BYTE PTR [RDX + 0DH], 00H	;RESET INTERNAL TIMER
			
	NEXTENEMYHITCHECK2:
		ADD RDX, ENEMYOBJSIZE
		INC RCX
		CMP RCX, NUMBEROFENEMY
		JNZ ENEMYHITCHECK2
	
	POP RCX
	MOV RBX, R12
	NEXTBOLTBOX:
	ADD RBX, BOLTOBJSIZE
	INC RCX
	CMP RCX, 08H
	JNZ CALCBOLTBOX
	
	
ENDM

SHIPEXPLODE MACRO	
	;EXPLODE THE SHIP:
	INC EXPLODEFRAMERULEC
	MOV RAX, EXPLODEFRAMERULEC
	CMP RAX, EXPLODEFRAMERULE
	JNZ ENDSHIPEXPLODE
		XOR RAX, RAX
		MOV EXPLODEFRAMERULEC, RAX
		
		;INCREASE EXPLOSION:
		LEA RDX, QWORD PTR [SPRITES]
		MOV RAX, EXPLODETIMER
		ADD AL, 029H
		MOV BYTE PTR [RDX + 02H], AL 	;SPRITES
		INC EXPLODETIMER
		MOV RAX, EXPLODETIMER
		CMP AL, 06H
		JNZ ENDSHIPEXPLODE
			;END GAME
			INC RESET
	
	ENDSHIPEXPLODE:
ENDM


RENDERHITBOXES MACRO
    LOCAL ENEMYRENDERHBLOOP
    LOCAL NEXTEHB
    LOCAL BOLTRENDERHBLOOP
    LOCAL NEXTBHB
    
    ; SHOW SHIP HITBOX
    XOR RAX, RAX
    MOV AL, BYTE PTR [SHIPHITBOX]
    MOV R10, RAX
        SHL R10, 02H
        ADD R10, 080H
    MOV AL, BYTE PTR [SHIPHITBOX + 01H]
    MOV R11, RAX
        SHL R11, 02H
    MOV AL, BYTE PTR [SHIPHITBOX + 02H]
    MOV R12, RAX
        SHL R12, 02H
    MOV AL, BYTE PTR [SHIPHITBOX + 03H]
    MOV R13, RAX
        SHL R13, 02H
    
    LEA RDX, QWORD PTR [COLORRED]
    XOR RAX, RAX
    MOV AL, BYTE PTR [SHIPALT]
    SHL RAX, 02H
    ADD RDX, RAX
    BLTRECT 0, 0, R10, R11, R12, R13
    
    ; ENEMY HITBOXES
    MOV RCX, NUMBEROFENEMY
    LEA RBX, QWORD PTR [ENEMY]
ENEMYRENDERHBLOOP:
    MOV AL, BYTE PTR [RBX]
    CMP AL, 00H
    JZ NEXTEHB
    
    XOR RAX, RAX
    MOV AL, BYTE PTR [RBX + 04H]
    ADD AL, BYTE PTR [RBX + 08H]
    MOV R10, RAX
        SHL R10, 02H
        ADD R10, 080H
    MOV AL, BYTE PTR [RBX + 06H]
    ADD AL, BYTE PTR [RBX + 09H]
    MOV R11, RAX
        SHL R11, 02H
    MOV AL, BYTE PTR [RBX + 0AH]
    MOV R12, RAX
        SHL R12, 02H
    MOV AL, BYTE PTR [RBX + 0BH]
    MOV R13, RAX
        SHL R13, 02H
    
    LEA RDX, QWORD PTR [COLORRED]
    XOR RAX, RAX
    MOV AL, BYTE PTR [RBX + 0CH]
    SHL RAX, 02H
    ADD RDX, RAX
        PUSH RBX
        PUSH RCX
    BLTRECT 0, 0, R10, R11, R12, R13
        POP RCX
        POP RBX
NEXTEHB:
    ADD RBX, ENEMYOBJSIZE
    DEC RCX
    CMP RCX, 00H
    JNZ ENEMYRENDERHBLOOP
    
    ; BOLT HITBOXES
    MOV RCX, 08H
    LEA RBX, QWORD PTR [BOLTS]
BOLTRENDERHBLOOP:
    MOV AL, BYTE PTR [RBX]
    CMP AL, 00H
    JZ NEXTBHB
    
    XOR RAX, RAX
    MOV AL, BYTE PTR [RBX + 04H]
    ADD AL, BYTE PTR [RBX + 08H]
    MOV R10, RAX
        SHL R10, 02H
        ADD R10, 080H
    MOV AL, BYTE PTR [RBX + 06H]
    ADD AL, BYTE PTR [RBX + 09H]
    MOV R11, RAX
        SHL R11, 02H
    MOV AL, BYTE PTR [RBX + 0AH]
    MOV R12, RAX
        SHL R12, 02H
    MOV AL, BYTE PTR [RBX + 0BH]
    MOV R13, RAX
        SHL R13, 02H
    
    LEA RDX, QWORD PTR [COLORRED]
    XOR RAX, RAX
    MOV AL, BYTE PTR [RBX + 0CH]
    SHL RAX, 02H
    ADD RDX, RAX
        PUSH RBX
        PUSH RCX
    BLTRECT 0, 0, R10, R11, R12, R13
        POP RCX
        POP RBX
NEXTBHB:
    ADD RBX, BOLTOBJSIZE
    DEC RCX
    CMP RCX, 00H
    JNZ BOLTRENDERHBLOOP
ENDM

ENDIF
