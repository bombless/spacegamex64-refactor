
IFNDEF MACROS_GAME_UI_INC
MACROS_GAME_UI_INC EQU 1



INITTITLE MACRO
    LEA RDX, QWORD PTR [loadTitleImgBin]
    BLTBUFF 0, 0, 0, 0, 1280, 1024
    MOV RAX, SPRITEVERSION
    MOV RBX, 01F720H
    MUL RBX
    LEA RDX, QWORD PTR [shipImg]
    ADD RDX, RAX
    BLTBUFF 0, 0, 534, 477, 230, 140
    MOV TITLECOUNTER, 080H
ENDM

RESETTITLE MACRO
    MOV TITLEON, 01H
    INITTITLE
ENDM


TITLELOGIC MACRO 
	;CHECK FOR SPRITE SWAP:
	CMP TITLESWAPCOUNTER, 00H
	JNZ DECREASESWAPCOUNTER
		;CHECK LEFT AND RIGHT
		MOV AL, BYTE PTR [PRESSEDLEFT]
		OR AL, BYTE PTR [POINTERLEFT]
		OR AL, BYTE PTR [PRESSEDRIGHT]
		OR AL, BYTE PTR [POINTERRIGHT]
		CMP AL, 00H
		JZ CHECKFIREPRESS
			;SWAP GRAPHICS USED
			XOR SPRITEVERSION, 01H
			MOV TITLESWAPCOUNTER, 80H
			;OUTPUT TO SCREEN
			MOV RAX, SPRITEVERSION
			MOV RBX, 01F720H
			MUL RBX
			LEA RDX, QWORD PTR [shipImg]
			ADD RDX, RAX
			BLTBUFF 0, 0, 534, 477, 230, 140	;RDX LOADED WITH POINTER TO BUFFER
	DECREASESWAPCOUNTER:
		DEC TITLESWAPCOUNTER
		
	CHECKFIREPRESS:
	;WAIT FOR FIRE TO PRESS
	MOV RAX, TITLECOUNTER
	CMP RAX, 00H
	JZ CHECKTITLEPRESS
		DEC TITLECOUNTER
		JMP ENDTITLELOGIC
	CHECKTITLEPRESS:
	MOV AL, BYTE PTR [PRESSEDFIRE]
	OR AL, BYTE PTR [POINTERFIRE]
	CMP AL, 00H
	JZ ENDTITLELOGIC
		MOV TITLEON, 00H	;TITLE OFF, START GAME
		RESETGAME
	ENDTITLELOGIC:
ENDM



RENDERTILE MACRO TRANSPARENCY
    LOCAL RENDER8x8LOOP
    LOCAL PUSHPIXELTOTILE
    LOCAL PUSHPIXELNOOFFSET
    LOCAL AFTERPUSHPTT
    LOCAL AFTERRENDER8x8
    
    MOV R9, RAX
    
    MOV RAX, RBX
    XOR RDX, RDX
    MOV R10, 020H
    DIV R10
    MOV RBX, RDX
    MOV R10, 02000H
    MUL R10
    SHL RBX, 05
    ADD RAX, RBX
    LEA R12, QWORD PTR [OUTPUTFBUFFER]

    SHL R9, 08H
    LEA R10, QWORD PTR [bgTiles]
    ADD R9, R10
    MOV RCX, 00H
    MOV R11, RAX
    MOV RAX, (TRANSPARENCY)
RENDER8x8LOOP:
    MOV EBX, DWORD PTR [R9]
        CMP AL, 00H
        JZ PUSHPIXELTOTILE
        TEST EBX, 0FFFFFFH
        JZ AFTERPUSHPTT
PUSHPIXELTOTILE:
        CMP AL, 00H
        JNZ PUSHPIXELNOOFFSET
        PUSH RAX
        XOR RAX, RAX
        MOV R14, R11
        SHR R14, 02H
        MOV AL, BYTE PTR [TM0XOFFSET]
        ADD RAX, R14
        AND RAX, 0FFH
        SHL RAX, 02H
        MOV R13, RAX
        XOR RAX, RAX
        MOV R14, R11
        SHR R14, 0AH
        MOV AL, BYTE PTR [TM0YOFFSET]
        ADD RAX, R14
        AND RAX, 0FFH
        SHL RAX, 0AH
        ADD R13, RAX
        POP RAX
    MOV DWORD PTR [R12 + R13], EBX
    JMP AFTERPUSHPTT
PUSHPIXELNOOFFSET:
    MOV DWORD PTR [R12 + R11], EBX
AFTERPUSHPTT:
    ADD R11, 04H
    ADD R9, 04H
    INC RCX
    TEST RCX, 07H
    JNZ RENDER8x8LOOP
        CMP RCX, 040H
        JZ AFTERRENDER8x8
        ADD R11, 03E0H
        JMP RENDER8x8LOOP
AFTERRENDER8x8:
ENDM

ENDIF

